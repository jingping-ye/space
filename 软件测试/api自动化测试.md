## API自动化测试

## API测试工具

### 基本步骤

1. 准备测试数据（这是可选步骤，不一定所有 API 测试都需要这一步）；
2. 通过 API 测试工具，发起对被测 API 的 request；
3. 验证返回结果的 response。

### 测试工具

- 命令行工具 cURL
- 图形界面工具 Postman 
-  SoapUI
- API 性能测试的 JMeter

### 注意要点

1. 有session或者cookie的场景
2. 请求方式
3. 使用协议
4. 返回结果验证: 返回状态码、响应时间、响应头参数、响应体

### 复杂API测试

- 由前一个api的返回结果来决定接下来调用哪一个api,api调用序列：分析用户行为日志
- api依赖问题：使用Mock Server替代真实API
- 异步API:对异步 API 的测试主要分为两个部分：一是，测试异步调用是否成功，二是，测试异步调用的业务逻辑处理是否正确。

## API测试框架的发展

1. postman 难以持续集成

2.  postman+newman+jenkins: 不方便处理多个api连续调用问题

3. 基于代码的框架

   - Java- OkHttp+Unirest:
- Python- http.client+Requests
   - NodeJS-Native+Request
   - Rest-Assured
   - httprunner的yml脚本规则/json --> 抓包 看到自己的所有请求，并且自动转为测试脚本；通过拖拽等性质组装成自动化测试集，并可以执行调试、定时任务。结合locusr可以直接做性能测试

4. 自动生成api测试代码

   > 需要自己实现
   
   - 本质:解析 Collection JSON 文件的各个部分，然后根据自研 API 框架的代码模板实现变量替换。 
   - 实现过程
     - 首先，根据自研 API 框架的代码结构建立一个带有变量占位符的模板文件；
     - 然后，通过 JSON 解析程序，按照 Collection JSON 文件的格式定义去提取 header、method 等信息；
     - 最后，用提取得到的具体值替换之前模板文件中的变量占位符，这样就得到了可执行的自研框架的 API 测试用例代码。
   
   

## 微服务下的API测试

### 微服务架构

#### 发展

- 单体架构

  单体架构是将所有的业务场景的表示层、业务逻辑层和数据访问层放在同一个工程中，最终经过编译、打包，并部署在服务器上。灵活性差、可扩展性差、稳定性差、可维护性差。

- 微服务架构

  微服务是一种架构风格。在微服务架构下，一个大型复杂软件系统不再由一个单体组成，而是由一系列相互独立的微服务组成。其中，各个微服务运行在自己的进程中，开发和部署都没有依赖。不同服务之间通过一些轻量级交互机制进行通信，例如 RPC、HTTP 等，服务可独立扩展伸缩，每个服务定义了明确的边界，只需要关注并很好地完成一件任务就可以了，不同的服务可以根据业务需求实现的便利性而采用不同的编程语言来实现，由独立的团队来维护。

#### 特点

1. 每个服务运行在其独立的进程中，开发采用的技术栈也是独立的；
2. 服务间采用轻量级通信机制进行沟通，通常是基于 HTTP 协议的 RESTful API；
3. 每个服务都围绕着具体的业务进行构建，并且能够被独立开发、独立部署、独立发布；
4. 对运维提出了非常高的要求，促进了 CI/CD 的发展与落地。



#### 测试挑战

1. 过于庞大的测试用例数量；
2. 微服务之间的耦合关系。

### 基于消费者契约的 API 测试





HTTPRunner api测试模块